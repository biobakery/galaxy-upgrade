<tool id="mmuphin" name="Meta-analysis Methods with Uniform Pipeline for Heterogeneity in Microbiome Studies" version="0.1.0" python_template_version="3.5">
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        bash '$__tool_directory__/mmuphin_wrapper.sh' '$feature_abd' '$batch' '$covariates' '$data' '$output1' '$output2'
            ]]></command>
    <inputs>
                <param type="data" name="feature_abd"  label="Feature-by-sample matrix of abundances (proportions or counts)" format="rdata"  />
                <param type="data" name="data"  label="Data frame of metadata" format="rdata"  />


                <param name="batch" type="select" format="text" >
                        <label>name of the batch variable</label>
                                <option value="studyID">studyID</option>
                </param>
                <param name="covariates" type="select" format="text" >
                        <label>name(s) of covariates to adjust for in the batch correction model</label>
                                <option value="study_condition">study_condition</option>
                </param>
    </inputs>
    <outputs>
        <data name="output1"  format="rdata" label="Adjusted abundance table" />
        <data name="output2"  format="pdf" label="Adjust batch diagnostic" />
    </outputs>
    <help><![CDATA[

 

**MMUPHin**
===========


MMUPHin is an R package implementing meta-analysis methods for microbial community profiles. It has interfaces for: a) covariate-controlled batch and study effect adjustment, b) meta-analytic differential abundance testing, and meta-analytic discovery of c) discrete (cluster-based) or d) continuous unsupervised population structure.

Overall, MMUPHin enables the normalization and combination of multiple microbial community studies. It can then help in identifying microbes, genes, or pathways that are differential with respect to combined phenotypes. Finally, it can find clusters or gradients of sample types that reproduce consistently among studies.




**Inputs**
==========

As input, MMUPHin requires a properly formatted collection of microbial community studies, with both feature abundances and accompanying metadata. Here we use the five published colorectal cancer (CRC) stool metagenomic studies, incorporated in Thomas et al. (2019). Data for the studies are already conveniently packaged and accessible through the Biocondcutor package curatedMetagenomicData, though additional wranglings are needed to format input for MMUPHin.

Importantly, MMUPHin asks that feature abundances be provided as a feature-by-sample matrix, and the metadata be provided as a data frame. The two objects shoud agree on sample IDs, that is, rowname of the feature abundance matrix and colname of the metadata data frame must agree. Many popular ’omic data classes in R already enforce this standard, such as ExpressionSet from Biobase, or phyloseq from phyloseq.

To minimize users’ efforts in loading data to run the examples, we have properly formatted the five studies for easy access. The feature abundances and metadata can be loaded with the following code chunk. For the interested user, the commented out scripts were used for accessing data directly from curatedMetagenomicData and formatting. It might be worthwhile to read through these as they perform many of the common tasks for preprocessing microbial feature abundance data in R, including sample/feature subsetting, normalization, filtering, etc.

As an example we privide two sample files taken from colorectal cancer (CRC) stool metagenomic studies:


..  _CRC_Feature_Abundances:  https://github.com/biobakery/galaxy-upgrade/blob/main/mmuphin/CRC_abd.Rda
..  _CRC_Metadata: https://github.com/biobakery/galaxy-upgrade/blob/main/mmuphin/CRC_meta.Rda


* CRC_Feature_Abundances_ 
* CRC_Metadata_

**Outputs**
===========

In the Galaxy interface we  provide **two** outputs,  a pdf  and an "RData" file 

* Adjust batch diagnostic pdf
* Adjusted abundance table:     Should be downloaded and openned with R as follows:

R
load(&your_download_directory/Adjusted_abundance_table].rdata)


**Documentation**
=================

.. _MMUPHin_General_Documentation:  https://huttenhower.sph.harvard.edu/mmuphin/
.. _MMUPHin_User_Manual:   https://bioconductor.org/packages/release/bioc/vignettes/MMUPHin/inst/doc/MMUPHin.html
.. _MMUPHin_Tutorial:  https://bioconductor.org/packages/release/bioc/vignettes/MMUPHin/inst/doc/MMUPHin.html
.. _MMUPHin_User_Forum:  https://forum.biobakery.org/

*  MMUPHin_General_Documentation_
*  MMUPHin_User_Manual_
*  MMUPHin_Tutorial_
*  MMUPHin_User_Forum_


 

 
    ]]></help>
</tool>
