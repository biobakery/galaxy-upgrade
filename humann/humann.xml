<tool id="HUMAnN" name="HUMAnN" version="0.1.5" python_template_version="3.5">
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        myFileSizeCheck=$(stat -c %s $input) &&
        Thresh=4194304 &&
        if (( $myFileSizeCheck > $Thresh )); then
            exit 9
        fi 
        &&
        humann -i $input -o humann_analysis &&
        cp humann_analysis/*_genefamilies.tsv  $output1 &&
        cp humann_analysis/*_pathabundance.tsv  $output2 && 
        cp humann_analysis/*_pathcoverage.tsv  $output3  
    ]]></command>
    <stdio>
    		<exit_code range="9" level="fatal" description="Input dataset size is too large (Threshold is 4Mb): Please run it out of Galaxy" />
	</stdio>

    <inputs>
        <param type="data" name="input" format="fasta, fastq" />
       	
    </inputs>
    <outputs>
        <data name="output1" format="tsv"  label="Gene families"/>
        <data name="output2" format="tsv"  label="Path Abundances"/>
        <data name="output3" format="tsv"  label="Path Coverages"/>
    </outputs>
    <help><![CDATA[
        HUMAnN is a pipeline for efficiently and accurately profiling the presence/absence and abundance of microbial pathways in a community from metagenomic or metatranscriptomic sequencing data (typically millions of short DNA/RNA reads). This process, referred to as functional profiling, aims to describe the metabolic potential of a microbial community and its members. More generally, functional profiling answers the question "What are the microbes in my community-of-interest doing (or capable of doing)?"


.. image:: https://raw.githubusercontent.com/biobakery/biobakery/master/images/humann3demo-plot2-2021.png
    :height: 500        
    :width: 600 	

**Features**
============



1. Community functional profiles stratified by known and unclassified organisms
- MetaPhlAn and ChocoPhlAn pangenome database are used to facilitate fast, accurate, and organism-specific functional profiling
- Organisms included are Archaea, Bacteria, Eukaryotes, and Viruses

2. Considerably expanded databases of genomes, genes, and pathways
- UniRef database provides gene family definitions
MetaCyc provides pathway definitions by gene family
MinPath is run to identify the set of minimum pathways

3. A simple user interface (single command driven flow)
- The user only needs to provide a quality-controlled metagenome or metatranscriptome

4. Accelerated mapping of reads to reference databases (including run-time generated databases tailored to the input)
- Bowtie2 is run for accelerated nucleotide-level searches
- Diamond is run for accelerated translated searches


**Workflow by input file type:**
================================
There are four different types of files that can be provided as input to HUMAnN 3.0 . 

By default HUMAnN 3.0 will determine the type of the file. As shown in the figure below, the type of input file will determine where HUMAnN 3.0 will start the workflow. Files of type 2, 3, and 4 will begin the workflow after the alignment steps.



**File Types:**
===============


* File Type 1 (a quality-controlled metagenome or metatranscriptome)
    1. fastq (fastq.gz)
    2. fasta (fasta.gz)


* File Type 2 (alignment results type 1)
    1. sam
    2. bam


* File Type 3 (alignment results type 2)
    1. blast-like tsv


* File Type 4 (gene table)
    1. tsv



**Citation**
============

If you use HUMAnN 3.0 in your work, please cite the HUMAnN 3.0 paper:

Francesco Beghini, Lauren J McIver, Aitor Blanco-MÃ¬guez, Leonard Dubois, Francesco Asnicar, Sagun Maharjan, Ana Mailyan, Andrew Maltez Thomas, Paolo Manghi, Mireia Valles-Colomer, George Weingart, Yancong Zhang, Moreno Zolfo, Curtis Huttenhower, Eric A Franzosa, Nicola Segata 

    ]]></help>
</tool>
